@if (loading()) {
  <p-progressSpinner class="flex" ariaLabel="loading" />
} @else {
  <div class="m-1 md:m-2 flex justify-content-between">
    @if (isSearchMode) {
      <span class="p-input-icon-left">
        <i class="pi pi-search"></i>
        <input
          #searchFilter
          pInputText
          [placeholder]="'catalog.search' | t"
          (input)="onSearchFilter($any($event.target).value)"
          pAutoFocus
          [autofocus]="true"
        />
      </span>
      <div>
        <p-button
          icon="pi pi-filter-slash"
          [pTooltip]="'catalog.clearFilters' | t"
          tooltipPosition="left"
          (click)="clearFilters(searchFilter)"
          class="mr-2"
        />
        <p-button icon="pi pi-times" [pTooltip]="'catalog.speciesView' | t" tooltipPosition="left" (click)="showSpeciesView()" />
      </div>
    } @else {
      <p-button icon="pi pi-search" [pTooltip]="'catalog.search' | t" tooltipPosition="right" (click)="showSearchView()" />
      <p-button
        *ngIf="isShowSpeciesViewButtonShown"
        icon="pi pi-list"
        [pTooltip]="'catalog.speciesView' | t"
        tooltipPosition="right"
        (click)="showSpeciesView()"
      />
      <p-button
        *ngIf="isShowGroupViewButtonShown"
        icon="pi pi-th-large"
        [pTooltip]="'catalog.groupView' | t"
        tooltipPosition="right"
        (click)="showGroupView()"
      />
    }
  </div>
  <div class="grid grid-nogutter">
    @switch (mode()) {
      @case ("explore-groups") {
        @for (group of catalog; track $index) {
          <app-group-wrapper
            [title]="group.name | localizedName"
            [thumbnailSrc]="group.thumbnailSrc"
            (groupClick)="showSpeciesView()"
            class="col-12 md:col-6 xl:col-4 p-1 md:p-2"
          />
        }
      }

      @case ("explore-species") {
        @for (group of catalog; track $index) {
          <div class="col-12 p-1 md:p-2 text-xl" [ngClass]="{ 'font-semibold': !group.hasChildren }">
            {{ group.name | localizedName }}
          </div>
          @if (group.hasChildren) {
            @for (subgroup of group.subGroups; track $index) {
              <div class="col-12 p-1 md:p-2 font-semibold text-lg">{{ subgroup.name | localizedName }}</div>
              @for (item of subgroup.species; track $index) {
                <app-catalog-item
                  [item]="item"
                  (viewDetailClick)="viewDetail(item.code)"
                  class="col-12 md:col-6 xl:col-4 p-1 md:p-2"
                />
              }
            }
          } @else {
            @for (item of group.species; track $index) {
              <app-catalog-item
                [item]="item"
                (viewDetailClick)="viewDetail(item.code)"
                class="col-12 md:col-6 lg:col-4 p-1 md:p-2"
              />
            }
          }
        }
      }

      @case ("search") {
        <div *ngFor="let item of searchResult()" class="flex mb-2 p-1 shadow-1">
          <p-image
            [src]="item.fullsizeImgSrc"
            [previewImageSrc]="item.thumbnailSrc"
            width="150"
            [preview]="true"
            loading="lazy"
            [alt]="item.name.latin"
            class="mr-1"
          />
          <div class="flex flex-column">
            <p-tag>{{ item.name.latin }}</p-tag>
            <div class="font-semibold text-md">{{ item.name.localized | localizedName }}</div>
          </div>
          <div class="ml-auto flex flex-column justify-content-center">
            <p-button icon="pi pi-eye" [pTooltip]="'catalog.view' | t" tooltipPosition="left" (click)="viewDetail(item.code)" />
          </div>
        </div>
      }

      @default {}
    }
  </div>
}
